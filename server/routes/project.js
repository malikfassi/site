var r = {"object":null,"status":0,"message":null,"listItems":[{"id":751,"name":"GUENOUN","firstName":"Mohammed","phone":"(0660)124578","birthDate":0,"noImmatriculation":null,"amount":null,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456232323245","refsEmploi":[{"id":2,"code":"TEC","libelle":"Technicien","traceToken":null},{"id":3,"code":"MGR","libelle":"Manager","traceToken":null}],"refType":{"id":2,"code":"CST","libelle":"Consulting","traceToken":null},"refsFormation":[{"id":551,"intitule":"java","traceToken":null,"refFormateur":{"id":2,"code":"AB","libelle":"Aziz BADDOU","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":806,"name":"AISSAOUI","firstName":"Abdellah","phone":null,"birthDate":0,"noImmatriculation":null,"amount":null,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456260568378","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null}],"refType":{"id":2,"code":"CST","libelle":"Consulting","traceToken":null},"refsFormation":[{"id":601,"intitule":"css","traceToken":null,"refFormateur":{"id":1,"code":"AA","libelle":"Ahmed AZZAM","traceToken":null},"refProject":null},{"id":753,"intitule":"Surveillance","traceToken":null,"refFormateur":{"id":153,"code":"SJ","libelle":"Jamal SAMI","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":807,"name":"ZOUAOUI","firstName":"Adil","phone":"(0660)256372","birthDate":null,"noImmatriculation":25367,"amount":100000.0,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456273575354","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null}],"refType":{"id":2,"code":"CST","libelle":"Consulting","traceToken":null},"refsFormation":[{"id":602,"intitule":"css","traceToken":null,"refFormateur":{"id":1,"code":"AA","libelle":"Ahmed AZZAM","traceToken":null},"refProject":null},{"id":603,"intitule":"Java","traceToken":null,"refFormateur":{"id":2,"code":"AB","libelle":"Aziz BADDOU","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":808,"name":"PAYLAN","firstName":"Azzeddine","phone":null,"birthDate":570844800000,"noImmatriculation":null,"amount":null,"traceToken":null,"workflowState":"REJETE","workflow":"Workflow Project","processIdentifier":"1456274499927","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null},{"id":2,"code":"TEC","libelle":"Technicien","traceToken":null}],"refType":{"id":4,"code":"APP","libelle":"Appareillage","traceToken":null},"refsFormation":[{"id":604,"intitule":"Angular","traceToken":null,"refFormateur":{"id":1,"code":"AA","libelle":"Ahmed AZZAM","traceToken":null},"refProject":null},{"id":605,"intitule":"css","traceToken":null,"refFormateur":{"id":2,"code":"AB","libelle":"Aziz BADDOU","traceToken":null},"refProject":null},{"id":606,"intitule":"Python","traceToken":null,"refFormateur":{"id":101,"code":"MK","libelle":"Mohammed KABBAJ","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":851,"name":"ABBADI","firstName":"Boubker","phone":"(0660)161608","birthDate":-374025600000,"noImmatriculation":123123,"amount":100.0,"traceToken":null,"workflowState":"REJETE","workflow":"Workflow Project","processIdentifier":"1456314218317","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null},{"id":2,"code":"TEC","libelle":"Technicien","traceToken":null}],"refType":{"id":2,"code":"CST","libelle":"Consulting","traceToken":null},"refsFormation":[{"id":651,"intitule":"css","traceToken":null,"refFormateur":{"id":101,"code":"MK","libelle":"Mohammed KABBAJ","traceToken":null},"refProject":null},{"id":653,"intitule":"Java","traceToken":null,"refFormateur":{"id":101,"code":"MK","libelle":"Mohammed KABBAJ","traceToken":null},"refProject":null},{"id":654,"intitule":"Angular","traceToken":null,"refFormateur":{"id":51,"code":"IM","libelle":"Issam MESRAR","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":852,"name":"BADDOU","firstName":"Zaki","phone":"(0668)457858","birthDate":-441676800000,"noImmatriculation":123,"amount":200000.0,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456314907579","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null},{"id":2,"code":"TEC","libelle":"Technicien","traceToken":null}],"refType":{"id":1,"code":"DEV","libelle":"Développement","traceToken":null},"refsFormation":[{"id":656,"intitule":"Rugby","traceToken":null,"refFormateur":{"id":1,"code":"AA","libelle":"Ahmed AZZAM","traceToken":null},"refProject":null},{"id":657,"intitule":"Football","traceToken":null,"refFormateur":{"id":2,"code":"AB","libelle":"Aziz BADDOU","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":853,"name":"ZAHOUANI","firstName":"Zahra","phone":"(0665)457845","birthDate":0,"noImmatriculation":null,"amount":20000.0,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456336191364","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null}],"refType":{"id":2,"code":"CST","libelle":"Consulting","traceToken":null},"refsFormation":[{"id":658,"intitule":"python","traceToken":null,"refFormateur":{"id":1,"code":"AA","libelle":"Ahmed AZZAM","traceToken":null},"refProject":null},{"id":851,"intitule":"Angular","traceToken":null,"refFormateur":{"id":51,"code":"IM","libelle":"Issam MESRAR","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":854,"name":"ZAMORANO","firstName":"Christian","phone":"(0654)458874","birthDate":-374025600000,"noImmatriculation":null,"amount":200000.0,"traceToken":null,"workflowState":"REJETE","workflow":"Workflow Project","processIdentifier":"1456337537333","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null}],"refType":{"id":1,"code":"DEV","libelle":"Développement","traceToken":null},"refsFormation":[{"id":901,"intitule":"css","traceToken":null,"refFormateur":{"id":1,"code":"AA","libelle":"Ahmed AZZAM","traceToken":null},"refProject":null},{"id":902,"intitule":"Java","traceToken":null,"refFormateur":{"id":101,"code":"MK","libelle":"Mohammed KABBAJ","traceToken":null},"refProject":null},{"id":1051,"intitule":"Angular","traceToken":null,"refFormateur":{"id":51,"code":"IM","libelle":"Issam MESRAR","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":855,"name":"LABIAD","firstName":"Ghali","phone":"(0661)124592","birthDate":79228800000,"noImmatriculation":1112,"amount":100000.0,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456339357368","refsEmploi":[{"id":1,"code":"AG","libelle":"Agriculteur","traceToken":null}],"refType":{"id":3,"code":"MO","libelle":"Main d'oeuvre","traceToken":null},"refsFormation":[],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null},{"id":901,"name":"OUZIF","firstName":"Samir","phone":"(0660)558965","birthDate":0,"noImmatriculation":123123,"amount":100000.0,"traceToken":null,"workflowState":"VALIDE","workflow":"Workflow Project","processIdentifier":"1456404463408","refsEmploi":[{"id":2,"code":"TEC","libelle":"Technicien","traceToken":null}],"refType":{"id":2,"code":"CST","libelle":"Consulting","traceToken":null},"refsFormation":[{"id":701,"intitule":"Surveillance","traceToken":null,"refFormateur":{"id":2,"code":"AB","libelle":"Aziz BADDOU","traceToken":null},"refProject":null}],"transition":null,"entiteClassName":null,"entiteId":null,"typeEntite":null,"forward":null}],"count":44,"misc":null};
var projects = r.listItems;

function clone(obj){
  try{
    var copy = JSON.parse(JSON.stringify(obj));
  } catch(ex){
    alert("Vous utilisez un vieux navigateur bien pourri, qui n'est pas pris en charge par ce site");
  }
  return copy;
}

/*
 * GET projects listing.
 */
exports.findAll = function(req, res) {
  res.status(200).json(r);
};

/*
 * GET project by identifier.
 */
exports.findById = function(req, res) {
  var id = req.params.id,
      i;

  for (i = 0; i < projects.length; i++) {
    if (projects[i].id == id) {
      r.object = projects[i];
      res.status(200).json(r);
      return;
    }
  }
  res.status(404).json("Not found");

};

/*
 * Create a project.
 */
exports.addProject = function(req, res) {
  var project = req.body;
  project.id  = Math.random().toString(36).substring(2);
  projects.push(project);
  res.status(200).json(project);
};

/*
 * Edit a project by is identifier (lock it for update).
 */
exports.editProject = function(req, res) {

  var id = req.params.id,
  i;

  for (i = 0; i < projects.length; i++) {
    if (projects[i].id == id) {
      console.log('project found. Id = '+id);
      r.object = projects[i];
      res.status(200).json(r);
      return;
    }
  }
  res.status(404).json("Not modified");
};

/*
 * Cancel Edition of  a project by is identifier (unlock it).
 */
exports.cancelEditProject = function(req, res) {

  var id = req.params.id,
    i;

  projects = r.listItems;

  for (i = 0; i < projects.length; i++) {
    if (projects[i].id == id) {
      console.log('project unlocked. Id = '+id);
      r.object = projects[i];
      res.status(200).json(r);
      return;
    }
  }
  res.status(404).json("Not modified");
};


/*
 * Update a project by is identifier.
 */
exports.updateProject = function(req, res) {
  var project = req.body,
      id      = project.id,
      i;

  for (i = 0; i < projects.length; i++) {
    if (projects[i].id == id) {
      projects[i] = clone(project);
      r.object = projects[i];
      res.status(200).json(r);
      return;
    }
  }
  res.status(404).json("Not modified");
};

/*
 * GET projects listing.
 */
exports.deleteProject = function(req, res) {

  var id = req.params.id,
      i;

  for (i = 0; i < projects.length; i++) {
    if (projects[i].id == id) {
      projects.splice(i, 1);
      res.status(200).json();
      return;
    }
  }

  res.status(404).json("Not deleted");
};
